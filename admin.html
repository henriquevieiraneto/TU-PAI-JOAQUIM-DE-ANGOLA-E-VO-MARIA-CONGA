<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel Master | TU Pai Joaquim</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-box { background: var(--glass); padding: 25px; border-radius: 15px; border: 1px solid var(--glass-border); margin-bottom: 20px; }
        .card-edit { border-left: 5px solid var(--primary-neon); background: rgba(0,0,0,0.3); position: relative; }
        input { width: 100%; padding: 10px; margin: 5px 0 15px 0; background: #000; border: 1px solid #333; color: white; border-radius: 5px; }
        .btn { padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; }
        .btn-add { background: var(--primary-neon); color: black; margin-bottom: 20px; }
        .btn-save { background: #28a745; color: white; font-size: 1.2rem; position: sticky; top: 10px; z-index: 100; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .btn-del { background: #dc3545; color: white; width: auto; padding: 5px 15px; font-size: 0.7rem; }
        label { font-size: 0.7rem; color: var(--primary-neon); text-transform: uppercase; letter-spacing: 1px; }
        #log { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 10px 20px; background: var(--primary-neon); color: black; border-radius: 20px; display: none; font-weight: bold; z-index: 1000; }
    </style>
</head>
<body>
    <header><h1>GEST√ÉO DO CORPO MEDI√öNICO</h1></header>
    <main class="container">
        
        <div id="login-screen" class="admin-box" style="max-width: 400px; margin: auto;">
            <input type="text" id="user" placeholder="Nome Completo">
            <input type="password" id="pass" placeholder="Senha">
            <button class="btn btn-add" onclick="login()">ENTRAR NO SISTEMA</button>
        </div>

        <div id="main-screen" class="hidden" style="display:none;">
            <button class="btn btn-save" onclick="enviarParaGithub()">üíæ SALVAR TODAS AS ALTERA√á√ïES NO SITE</button>
            <button class="btn btn-add" onclick="adicionarNovo()">+ ADICIONAR NOVO IRM√ÉO/IRM√É</button>
            <div id="lista-edicao"></div>
        </div>
    </main>

    <div id="log">Processando...</div>

    <script>
        const REPO_INFO = {
            owner: 'henriquevieiraneto',
            repo: 'TU-PAI-JOAQUIM-DE-ANGOLA-E-VO-MARIA-CONGA',
            path: 'dados.json'
        };

        let db = { mediuns: [] };
        let currentSha = "";

        function status(msg, tempo = 3000) {
            const l = document.getElementById('log');
            l.innerText = msg;
            l.style.display = 'block';
            if(tempo > 0) setTimeout(() => l.style.display = 'none', tempo);
        }

        async function login() {
            const u = document.getElementById('user').value;
            const p = document.getElementById('pass').value;

            if (u === "Henrique Vieira Neto" && p === "@Hvn2009") {
                await inicializarDados();
            } else {
                alert("Credenciais incorretas.");
            }
        }

        async function inicializarDados() {
            let t = localStorage.getItem('gh_token');
            if(!t) {
                t = prompt("Digite seu GitHub Token para prosseguir:");
                if(t) localStorage.setItem('gh_token', t);
                else return;
            }

            status("‚è≥ Carregando dados do servidor...");
            try {
                const res = await fetch(`https://api.github.com/repos/${REPO_INFO.owner}/${REPO_INFO.repo}/contents/${REPO_INFO.path}`, {
                    headers: { 'Authorization': `token ${t}` }
                });
                const data = await res.json();
                currentSha = data.sha;
                db = JSON.parse(atob(data.content));
                
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-screen').style.display = 'block';
                render();
                status("‚úÖ Dados carregados.");
            } catch (e) {
                alert("Erro de conex√£o. Verifique o Token.");
                localStorage.removeItem('gh_token');
            }
        }

        function render() {
            const cont = document.getElementById('lista-edicao');
            cont.innerHTML = "";
            db.mediuns.forEach((m, i) => {
                const item = document.createElement('div');
                item.className = 'admin-box card-edit';
                item.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <strong>M√âDIUM #${i+1}</strong>
                        <button class="btn btn-del" onclick="remover(${i})">REMOVER</button>
                    </div>
                    <label>Nome Completo</label>
                    <input type="text" value="${m.nome}" oninput="db.mediuns[${i}].nome = this.value.toUpperCase()">
                    
                    <label>Cargo/Fun√ß√£o</label>
                    <input type="text" value="${m.cargo}" oninput="db.mediuns[${i}].cargo = this.value">
                    
                    <label>Entidade Principal</label>
                    <input type="text" value="${m.entidade}" oninput="db.mediuns[${i}].entidade = this.value">
                    
                    <label>Caminho da Foto (Ex: ../img/nome.jpg)</label>
                    <input type="text" value="${m.foto}" oninput="db.mediuns[${i}].foto = this.value">
                `;
                cont.appendChild(item);
            });
        }

        function adicionarNovo() {
            db.mediuns.unshift({ nome: "NOVO M√âDIUM", cargo: "", entidade: "", foto: "../img/default.jpg" });
            render();
            window.scrollTo(0, 0);
        }

        function remover(i) {
            if(confirm(`Excluir ${db.mediuns[i].nome}?`)) {
                db.mediuns.splice(i, 1);
                render();
            }
        }

        async function enviarParaGithub() {
            const t = localStorage.getItem('gh_token');
            status("‚è≥ Sincronizando com GitHub...", 0);

            try {
                const res = await fetch(`https://api.github.com/repos/${REPO_INFO.owner}/${REPO_INFO.repo}/contents/${REPO_INFO.path}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${t}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: "Atualiza√ß√£o via Painel Master",
                        content: btoa(JSON.stringify(db, null, 2)),
                        sha: currentSha
                    })
                });

                if(res.ok) {
                    const resData = await res.json();
                    currentSha = resData.content.sha;
                    status("‚úÖ SITE ATUALIZADO COM SUCESSO!");
                } else {
                    throw new Error();
                }
            } catch (e) {
                alert("Erro ao salvar. Verifique se o Token ainda √© v√°lido.");
            }
        }
    </script>
</body>
</html>